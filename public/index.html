<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Carbon Intensity</title>
    <style>
        body {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            background-color: #f5f5f5;
            font-family: Arial, sans-serif;
        }
        #circle {
            width: 200px;
            height: 200px;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            color: white;
            font-size: 2em;
            font-weight: bold;
            text-align: center;
        }
    </style>
</head>
<body>
    <div id="circle">Loading...</div>

    <script>
        // Function to get color based on carbon intensity value
        function getColor(intensity) {
            const scale = [
                { value: 0, color: '#00ff00' },
                { value: 300, color: '#a8ff00' },
                { value: 600, color: '#ffff00' },
                { value: 900, color: '#ffa500' },
                { value: 1200, color: '#ff4500' },
                { value: 1500, color: '#ff0000' }
            ];

            for (let i = 0; i < scale.length - 1; i++) {
                if (intensity >= scale[i].value && intensity <= scale[i + 1].value) {
                    const ratio = (intensity - scale[i].value) / (scale[i + 1].value - scale[i].value);
                    const color = interpolateColor(scale[i].color, scale[i + 1].color, ratio);
                    return color;
                }
            }
            return '#ff0000'; // default color
        }

        // Function to interpolate between two colors
        function interpolateColor(color1, color2, factor) {
            const hex = function(x) {
                x = x.toString(16);
                return (x.length === 1) ? '0' + x : x;
            };

            const r1 = parseInt(color1.substring(1, 3), 16);
            const g1 = parseInt(color1.substring(3, 5), 16);
            const b1 = parseInt(color1.substring(5, 7), 16);

            const r2 = parseInt(color2.substring(1, 3), 16);
            const g2 = parseInt(color2.substring(3, 5), 16);
            const b2 = parseInt(color2.substring(5, 7), 16);

            const r = Math.ceil(r1 + factor * (r2 - r1));
            const g = Math.ceil(g1 + factor * (g2 - g1));
            const b = Math.ceil(b1 + factor * (b2 - b1));

            return '#' + hex(r) + hex(g) + hex(b);
        }

        // Fetch the carbon intensity data and update the circle color
        async function fetchData() {
            try {
                const response = await fetch('https://shrouded-basin-51086-f0068193f66e.herokuapp.com/data');
                const data = await response.json();
                const intensity = data.carbonIntensity;
                const color = getColor(intensity);

                document.getElementById('circle').style.backgroundColor = color;
                document.getElementById('circle').textContent = `${intensity} gCOâ‚‚eq/kWh`;
            } catch (error) {
                console.error('Error fetching data:', error);
                document.getElementById('circle').textContent = 'Error';
            }
        }

        fetchData();
    </script>
</body>
</html>
